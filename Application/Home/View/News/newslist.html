<include file="Public/header" />
<style type="text/css">
	.thumbnail h3 a {color:#000;text-decoration: none;}
</style>
<!--events start here-->
<div class="feature">
	<div class="container">
		<div class="feature-main">
			<div class="search feature-head">
				<h3>所有宝贝</h3>
				<p>
					<span class="label label-primary" rel="">全部</span>&nbsp;&nbsp;
					<foreach name="category" item="c_vo">
					<span class="label label-primary" rel="{$c_vo.id}">{$c_vo.name}</span>&nbsp;&nbsp; 
					</foreach>
				</p>
			</div>
			<form id="search" action="/home/news/newslist" method="post">
				<input type="hidden" name="category" class="search-category">
			</form>
		
			<div class="row">
			<div class="blog-masonry masonry-true">
				<foreach name="list" item="vo">
				<div class="col-sm-6 col-md-4 post-masonry">
					<div class="thumbnail">
						<img src="__PUBLIC__/uploads/{$vo.img}" alt="主图">
						<div class="caption">
							<h3><a href="/home/news/detail/id/{$vo.id}">{$vo.title}</a></h3>
							<div class="row">
						        <label for="lastname" class="text-right col-sm-6 col-sm-4 control-label">价格：</label>
						        <div class="col-sm-8">
						        	<h3 style="color:#f00">{$vo.price}元</h3>
						        </div>
						    </div>
						    <div class="row">
						        <label for="lastname" class="text-right col-sm-6 col-sm-4 control-label">联系人：</label>
						        <div class="col-sm-8">
						        	{$vo.relation_name}
						        </div>
						    </div>
						    <div class="row">
						        <label for="lastname" class="text-right col-sm-6 col-sm-4 control-label">联系方式：</label>
						        <div class="col-sm-8">
						        	{$vo.phone}
						        </div>
						    </div>
							<p rel="{$vo.id}">
								<button type="button" class="collect btn btn-default">
									<span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span> 收藏
								</button>
								<button type="button" class="mark btn btn-default">
									<span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> 举报
								</button>
							</p>
							
						</div>
					</div>
				</div>
				</foreach>
			</div>
			<div class="page">{$page}</div>
			</div>
		</div>
	</div>
</div>
<script src="__PUBLIC__/home/js/plugins.min.js"></script>
<script src="__PUBLIC__/home/js/main.min.js"></script>
<!--events end here-->
<div id="dialog" title="Mark News" style="display:none">
	<div class="form-group">
	    <label for="inputEmail3" class="col-sm-2 control-label">Email</label>
	    <div class="col-sm-10">
	      <input name="email" type="email" class="form-control" id="mark_email" placeholder="您的联系方式！">
	    </div>
	</div>
	<div class="form-group">
	    <label for="inputEmail3" class="col-sm-2 control-label">具体说明</label>
	    <div class="col-sm-10">
	      <textarea class="form-control" rows="3" name="mark_result" id="mark_result" placeholder="您举报此条信息的具体说明！"></textarea>
	    </div>
	</div>
	<div class="form-group">
	    <div class="col-sm-offset-2 col-sm-10">
	      <button type="submit" class="btn btn-default conform-mark">举报</button>
	    </div>
	</div>
</div>
<link rel="stylesheet" href="__PUBLIC__/vendors/jquery-ui/jquery-ui.css">
<script src="__PUBLIC__/vendors/jquery-ui/jquery-ui.js"></script>
<script>
$(function() {
	$('.mark').click(function(){
	 	$( "#dialog" ).dialog({height:300,width:600});
	});

	$('.conform-mark').click(function(){
		var id = $(this).closest('p').attr('rel');
		var email = $(this).closest('#dialog').find('input[name="email"]').val();
		var mark_result = $(this).closest('#dialog').find('textarea[name="mark_result"]').val();

		var filter  = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
		if (!filter.test(email)) 
		{
			alert('请输入正确的邮箱格式方便管理员及时联系你，谢谢！');
			return false;
		}

		$.ajax({
			url    : "/home/news/ajaxHandleMark",
			type   : "post",
			dataType: "json",
			data   : {
				id           :  id,
				email        :  email,
				mark_result  :  mark_result
			},
			success:function(data){
				$('#dialog').dialog( "close" );
				alert(data.info);
			}
		});
	});

	//收藏
	$('.collect').click(function(){
		var id = $(this).closest('p').attr('rel');
		var user_id = <?php if($_SESSION['me']['id']) echo $_SESSION['me']['id']; else echo 0; ?>;
		var btn = $(this);
		$.ajax({
			url    : "/home/news/ajaxHandleCollect",
			type   : "post",
			dataType: "json",
			data   : {
				id           :  id,
				user_id      :  user_id,
			},
			success:function(data){
				if(data.status == "OK")
				{
					btn.find('span').removeClass('glyphicon-star-empty').addClass('glyphicon-star');
				}
				else
				{
					alert(data.info);
				}
			}
		});
	});

	$('.search span').click(function(){
		//console.log($(this));
		var category_id = $(this).attr('rel');
		console.log(category_id);
		$('#search').find('.search-category').val(category_id);
		$('#search').submit();
	});
 
});

	
</script>
<include file="Public/footer" />